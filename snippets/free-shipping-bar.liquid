{%- doc -%}
  Renders a free shipping progress bar showing cart progress toward threshold.

  Displays dynamic messaging and visual progress, excluding gift wrap costs.

  @param {number} minimum_amount - Free shipping threshold in store currency

  @example
  {% render 'free-shipping-bar', minimum_amount: 50 %}
{%- enddoc -%}

{%- liquid
  assign minimum_amount_in_cents = minimum_amount | times: 100
  assign total_price = cart.total_price

  if cart != empty
    if settings.gift_wrap_product != blank and settings.gift_wrap_product.available
      assign gift_wrap_product = settings.gift_wrap_product
      assign gift_wrap_variant = gift_wrap_product.first_available_variant
      assign gift_items = cart.items | where: 'variant_id', gift_wrap_variant.id

      assign gift_wraps_in_cart = 0
      for item in gift_items
        assign gift_wraps_in_cart = gift_wraps_in_cart | plus: item.final_line_price
      endfor
      assign total_price = total_price | minus: gift_wraps_in_cart
    endif
  endif
-%}
<div class="free-shipping-bar grid gap-3 w-full">
  {%- if total_price >= minimum_amount_in_cents -%}
    <span class="text-sm leading-tight">{{ 'general.cart.free_shipping.congratulations_html' | t }}</span>
    <progress-bar class="overflow-hidden rounded-full" style="--progress: 100%;"></progress-bar>
  {%- else -%}
    {%- capture remaining_amount -%}<span class="font-bold">{{ total_price | minus: minimum_amount_in_cents | abs | money }}</span>{%- endcapture -%}
    <span class="text-sm leading-tight">{{ 'general.cart.free_shipping.remaining_html' | t: remaining_amount: remaining_amount }}</span>
    <progress-bar class="overflow-hidden rounded-full" style="--progress: {{ total_price | times: 1.0 | divided_by: minimum_amount_in_cents | at_most: 1 | times: 100 | round }}%;"></progress-bar>
  {%- endif -%}
</div>
